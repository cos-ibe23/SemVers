FROM node:20-alpine

# Install postgresql-client for pg_isready
RUN apk add --no-cache postgresql-client

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

# Make startup script executable
RUN chmod +x scripts/docker-test.sh

# Set test environment
ENV NODE_ENV=test

# No EXPOSE needed for test container
CMD ["sh", "scripts/docker-test.sh"]

